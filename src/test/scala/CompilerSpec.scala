import org.scalatest.{Matchers, WordSpec}
import org.scalatestplus.mockito._

class CompilerSpec extends WordSpec with MockitoSugar with Matchers {

  "Compiler" should {

    "compile LiveEpochScript correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/live_epoch.es", Some("src/test/resources/live_epoch_symbols.json"))

      ergoTree shouldBe "1014040004000e20749fe0b8c63213be3451af2578eacabd620a9e687f5c55c54f1ec571b17c9c850400040004020402010104020580b48913040204060500043c04020480b489130402050a05c8010402d806d601b2a5730000d602b5db6501fed9010263ed93e4c67202050ec5a7938cb2db63087202730100017302d603b17202d604e4c6b272027303000605d605d90105049590720573047204e4c6b272029972057305000605d606b07202860273067307d901063c400163d803d6088c720601d6098c720801d60a8c72060286029a72097308ededed8c72080293c2b2a5720900d0cde4c6720a040792c1b2a5720900730992da720501997209730ae4c6720a0605ea02d1ededededededed93cbc27201e4c6a7060e927203730b93db63087201db6308a793e4c6720104059db07202730cd9010741639a8c720701e4c68c72070206057e72030593e4c6720105049ae4c6a70504730d92c1720199c1a77e9c9a7203730e730f058c72060292da720501998c72060173109972049d9c720473117312b2ad7202d9010763cde4c672070407e4c6b2a5731300040400"
      hash shouldBe "31290f347f33d70dd573661b744b19cbe431f581802b8920e85192e2b6eecb1f"
      address shouldBe "8D6pdYVRvF6PcDZZ8HXaEv1VyWmYC8VV5mfmuVPCBHLCzzjWUu6vvrpJvN8uT7rJMKzJbGmVcaDJirPFeuTV1jgk3E1sF8KYKaQjvohyXfPsZhCqhsQ8oh5c3EKbmC4DeMBBxaEzUZZFmvFwpsoGMJvhwQKpwuEQZruTwdzjUxwfFMKyNtTBbAr3Pmz6NeB5ewyj2bSFcfN791G2jKB3VENA7pncaX3bPhL6aEDJstFBELa9a7uTeevA1sjcUwTyUDfShwyM2hE1RxRrCFMfiuzcR3nJYVLEsn3Y1ge6ThjQg8H3xFpXsJ6SfXtFhX2PdnhyjMD9mtkCjM6icsqNp12R7J58HenC1fv8KpuBU7GEmQAHEFr28Gr8GKafhiTsXzjtqbiV9b78A4wtWUBgbEPfrKhV1eB3fVKPQ73Gw8xwxTLBbXLKyVHT9kcrnUPQBGij4H1oaeNz2cr7eMdwiP2aA4XjUHDnct7ZiHn243UnqP7gveBGf1fcZMYNkjiXhFCRsjMhBQtjE9gtBMNoTJd3Y9tdjYn1YcHWbKQLvj27eD4XXpSSEXodBFuhM"
    }

    "compile EpochPrepScript correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/epoch_prep.es", Some("src/test/resources/epoch_prep_symbols.json"))

      ergoTree shouldBe "100604000580b48913043c0e20396b67b43d9436bb1f310050273f6f34b81beeca1ebea1f126486890d00a282c04280408d806d601b2a5730000d602c67201060ed603e4c6a70504d604c1a7d6059272047301d6069aa3730295e67202d801d607ed93e47202cbc2a793cbc272017303eb02d1ededededededed8fa3720391a39972037304720593e4c672010405e4c6a7040593e4c672010504720393db63087201db6308a792c1720172047207d1ededededededed92a37203720593e4c672010405e4c6a7040592e4c672010504720690e4c6720105049a7206730593db63087201db6308a792c1720172047207d1edededed93e4c672010405e4c6a7040593e4c672010504720393c27201c2a793db63087201db6308a791c172017204"
      hash shouldBe "d998e06e0c093b0990fa3da4f3bea4364546803551ea9cac02623e9675ba4522"
      address shouldBe "Gxd4hMRT5wUQ8JTfx9rqwTCXM8MZ5VC1143qtV393Cvum7kVyKkW1rAkj3FoHzFn44X94BQwsVFMdSibu9euVToxYPVpJMNnbqA83wst4jiYUMV1bFp5M4pgESHdD1mFieimi6z3dhZbtdsV2zQeShZCFBr6gXdnzuuRQAM9zXQuUGW4JfaXoz1FjFgRERRaxGGyD7gK61KwiRTCoZMDjZ1vmUuvfUfQda45j61fD8BZ1r3JMCX6h8vP9ZuRjDmheGLBdsqhf3rg6JV4xqsuqnSbhGXaTvNucPcA7EH4MAEj6jTkWvazv1nRMBM5kY6FpNQ4vQsbQFuJSciA2ZWTxS7dfyicYXZ6aCrBnmNi78u6bfQt2gKpHYq5Uh8sLUAPG3xXrjmETPmVf7"
    }

    "compile DataPointScript correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/data_point.es", Some("src/test/resources/data_point_symbols.json"))

      ergoTree shouldBe "100604000400050004000e200fb1eca4646950743bc5a8c341c16871a0ad9b4077e3b276bf93855d51a042d10e20396b67b43d9436bb1f310050273f6f34b81beeca1ebea1f126486890d00a282cd803d601b2a5730000d602e4c6a70407d603b2db6501fe730100ea02d1ededededed93e4c672010407720293e4c67201050ec5720391e4c672010605730293c27201c2a793db63087201db6308a7ed938cb2db6308720373030001730493cbc272037305cd7202"
      hash shouldBe "d0b341ec5b6b8e5b0f941facfdd452dace419273abd78a17d3e0710e3a96630e"
      address shouldBe "jL2aaqw6XU61SZznvnw681zGfmUQkZouLZ8uvwy36MJRbqZRxr7sFbLJKMDEFy42CBLZRCV3CazTqnnSooxnSptybik3VcMUTZcgGcicXN78topRx5qXK1xNVwn9FkBkyCb9umnhx967ixNwYd1z8xmWkbdLKNdbDLqGEKbVYbtFTY7qoY8VU3bDV4TRbp2D7G9MNoXDaEvVeLeymGSMuJC5sp4dptTRc9QSR158sJYppQYkAsSgwXbtoNJvq"
    }

    "compile PoolDepositScript correctly" in {
      val (ergoTree, hash, address) = Compiler.compile("src/test/resources/pool_deposit.es", Some("src/test/resources/pool_deposit_symbols.json"))

      ergoTree shouldBe "100804000e20d998e06e0c093b0990fa3da4f3bea4364546803551ea9cac02623e9675ba4522040004000500040004000e200fb1eca4646950743bc5a8c341c16871a0ad9b4077e3b276bf93855d51a042d1d802d601b2a4730000d602c27201d1ededed93cb7202730193c2b2a5730200720292c1b2a57303009ac17201b0b5a4d901036393c27203c2a77304d9010341639a8c720301c18c720302938cb2db6308b2a5730500730600017307"
      hash shouldBe "70ff2ce77ce8098ca1fb1f4f06c3c389eed1efa2dc283fcb94fb5ecafffd4d1f"
      address shouldBe "zLSQDVBaKPo3b92KyHXfjph18fbHyVCkNEt9WaWzQVc7LnfRKTwoBFzryPE2bEukR4jP8mDiRVgBtKM6peYGb1Rq6Hbi5y9qja5B7mBtRdhEPqJzc66WN74QbQ1yvBMJQzGNjD85xpiPgW3mEJ8NvLuYAZL97vkUYZzMEa38FVesfTPYsMn9bqiTX5ZL5ogimzRL9nFyaMbp3wDTZQNeJDhaJjr5mS7BvsrdjTwmiLsXFZVpcw"
    }

  }

}
